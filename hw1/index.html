<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="scripts\d3-geo-scale-bar\d3-geo-scale-bar.js"></script>


    <title>Trees</title>

    <link rel="stylesheet" href="style.css">

</head>

<body>
    <header id="header" class="flexrow">
        <a href="index.html">
            <h1>
                HW1: Trees of S.F.
            </h1>
        </a>

        <div>
            <a href="https://www.youtube.com/watch?v=VKMw2it8dQY">
                <h2>
                    Chris C.
                </h2>
            </a>
        </div>
    </header>

    <div id="hero">
        <div id="link_container">
            <div id="data_links">
                <a href="https://data.census.gov/table/ACSST5Y2022.S1903?q=median%20income&g=860XX00US94102,94103,94104,94105,94107,94108,94109,94110,94111,94112,94114,94115,94116,94117,94118,94121,94122,94123,94124,94127,94128,94129,94130,94131,94132,94133,94134,94158,94188
                ">
                    Median Income Census Data
                </a>

                <a href="https://www.sfgov.org/sfc/sites/default/files/Asthma/2016%20CHNA%20Asthma%20(1).pdf">
                    SF Asthma Data
                </a>

                <a href="https://data.sfgov.org/City-Infrastructure/Street-Tree-List/tkzw-k3nq">
                    SF Tree Dataset
                </a>
            </div>
            <div>
                <a href="https://mymaps.google.com">
                    Image Courtesy of Google Maps
                </a>
            </div>
        </div>
    </div>

    <main>
        <h2><em>Clever Title</em> : Visualizing S.F.'s Trees and Health Trends</h2>
        <p>
            The goal of this basic website is to explore trends (or the absence of them) in a dataset of San Francisco's trees.
        </p>
        <p>
            To supplement this analysis, we will also be visualizing two different datasets in addition to the trees:
            <ul>
                <li>Median Income</li>
                <li>Asthma Hospitalization Rates</li>
            </ul>
        </p>
        <hr>
        <h3>
            Basic Tree Plot
        </h3>
        <p>
            To start with, we will be looking at the distribution of trees based on whether or not they are privately
             or non-privately (publicly) owned.
        </p>
        <div id="treeDiv">
            <svg id="mainTree" width="600" height="550"></svg>
            <div>
                <svg id="privateTree" width="400" height="370"></svg>
                <svg id="nonPrivateTree" width="400" height="370"></svg>
            </div>
        </div>
        <script id="basicplot_script">
            var neighborhoods;
            const jsonLoader = async function () {
                var sf = await d3.json('data/SF-Neighborhoods.geo.json');
                neighborhoods = topojson.feature(sf, sf.objects.SFNeighborhoods);
                neighborhoods.features = neighborhoods.features.filter(d => !d.properties.name.includes("Island"));

            };

            function basicTreePlots(id, dataFilterFunction, color, r, text) {
                let svg = d3.select(`#${id}`);
                let mapWidth = svg.attr("width");
                let mapHeight = svg.attr("height") - 20;
                let map = svg.append("g").attr("transform", `translate(0, 20)`);

                let basicPlotMaker = async function () {
                    let projection = d3.geoMercator().fitSize([mapWidth, mapHeight], neighborhoods);
                    let path = d3.geoPath().projection(projection);

                    map.selectAll("path.neighborhood").data(neighborhoods.features)
                        .join("path")
                        .attr("name", d => d.properties.name)
                        .attr("class", "neighborhood")
                        .attr("d", path);

                    let weed = await d3.csv('data/Street_Tree_List-2022-01-30_FILTERED.csv', d3.autoType);
                    weed = weed.filter(d => dataFilterFunction(d))
                    weed.forEach(d => {
                        d.Position = projection([d.Longitude, d.Latitude]);
                    });
                    map.selectAll('circle').data(weed)
                        .join("circle")
                        .attr("r", r)
                        .attr("fill", color)
                        .attr("cx", d => d.Position[0])
                        .attr("cy", d => d.Position[1])
                        .attr("opacity", 0.4);

                    // Scale bar package created by Harry Stevens @ https://github.com/HarryStevens/d3-geo-scale-bar?tab=readme-ov-file
                    let scaleBar = d3.geoScaleBar()
                        .projection(projection)
                        .size([mapWidth, mapHeight])
                        .units(d3.geoScaleMiles)
                        .left(0.05)
                        .top(0.05)
                        .tickPadding(3)
                        .distance(1)
                        .tickValues([0, 0.5, 1]);
                    mapScaleBar = svg.append("g")
                        .call(scaleBar);
                    mapScaleBar.selectAll("rect")
                        .remove();

                    svg.append("text")
                        .text(text)
                        .attr("fill", "black")
                        .attr("x", mapWidth / 2)
                        .attr("y", 25)
                        .attr("text-anchor", "middle");
                };
                basicPlotMaker();
            };

            (async function () {
                await jsonLoader();
                basicTreePlots("mainTree", () => true, "#00573a", 1.5, "All Trees");
                basicTreePlots("privateTree", d => d.qCaretaker === 'Private', "#572e00", 1, "Privately Owned");
                basicTreePlots("nonPrivateTree", d => d.qCaretaker !== 'Private', "#572e00", 1, "Non-Privately Owned");
            })();

        </script>
        <p>
            We see here that privately trees are far greater in their distribution in the city when compared to non-private ones.
            Additionally, public trees are mainly concentrated <em>linearly</em>, which is what we would expect if the roads of 
            the city were straight lines (<a href="https://youtu.be/5ZwbZWrKbGI?si=jeg8WpnOHlBrrkfp" class="blue">This video</a> outlines why straight lines aren't the best for cities, though)
        </p>

        <hr>

        <h3>
            Basic Tree Plot
        </h3>
        <p>
            Interdum et malesuada fames ac ante ipsum primis in faucibus. Nulla vel volutpat odio. Maecenas vestibulum
            placerat dui ac vestibulum.
            Aliquam semper, metus in faucibus viverra, quam enim placerat massa, vitae ultrices ligula metus in ipsum.
            Suspendisse potenti. Nam in enim nec lectus blandit vehicula.
        </p>

        <svg width="700" height="620"></svg>


    </main>

    <footer>

    </footer>
</body>

</html>